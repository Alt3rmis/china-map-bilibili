# 数据获取脚本使用说明

## 方式一：Node.js 脚本（推荐）

```bash
node scripts/fetch-data.js
```

**优点：**
- 自动获取所有页面数据
- 自动解析城市名称
- 按发布时间排序
- 自动保存到 data/data.js

**注意事项：**
- B站 API 可能需要登录态，如果脚本返回错误，请使用方式二

## 方式二：浏览器脚本（备用）

1. 在浏览器中登录 B站（bilibili.com）
2. 打开合集页面：https://space.bilibili.com/238365787/lists/475111
3. 按 F12 打开开发者工具
4. 复制 `scripts/fetch-bilibili-data.js` 的内容到控制台
5. 等待数据获取完成
6. 复制输出的 data.js 格式代码
7. 粘贴到 data/data.js 文件中

## 方式三：手动获取（API 不可用时）

如果上述方式都不可用，可以手动获取数据：

### 步骤：

1. 访问合集页面：https://space.bilibili.com/238365787/lists/475111

2. 滚动页面查看所有视频标题

3. 根据标题确定城市，例如：
   - "快递里的中国 成都：蓉城的快递江湖" → 成都
   - "快递里的中国 深圳：鹏城的快递传奇" → 深圳

4. 按照 data/data.js 中的格式手动添加数据

### 城市归属映射表

| 城市 | 省份 |
|------|--------|
| 成都 | 四川 |
| 重庆 | 重庆 |
| 北京 | 北京 |
| 上海 | 上海 |
| 广州 | 广东 |
| 深圳 | 广东 |
| 南京 | 江苏 |
| 苏州 | 江苏 |
| 杭州 | 浙江 |
| 宁波 | 浙江 |
| 武汉 | 湖北 |
| 长沙 | 湖南 |

## API 参数说明

当前使用的 API 参数：

```
https://api.bilibili.com/x/polymer/web-space/seasons_archives_list
  ?mid=238365787                    # UP主ID
  &season_id=475111                  # 合集ID
  &sort_reverse=false                   # 是否倒序
  &page_size=30                        # 每页数量
  &page_num=1                          # 页码
  &web_location=333.1387                # Web位置参数
```

## 故障排查

### 脚本返回错误

**错误：** code: -352 或页面返回"找不到该页面"

**原因：** API 需要登录态

**解决方案：**
1. 先在浏览器登录 B站
2. 使用方式二（浏览器脚本）
3. 或使用方式三（手动获取）

### 获取到的城市数量不对

**原因：** 视频标题格式不一致

**解决方案：** 检查实际视频标题，调整 `parseCityFromTitle` 函数中的正则表达式

### 部分城市缺失

**原因：** 城市名称不匹配

**解决方案：** 手动检查缺失的城市，并添加到对应的省份映射中

## 数据格式要求

生成后的 data.js 必须符合以下格式：

```javascript
const cityData = {
    // 城市数据
    "城市名": {
        videos: [
            {
                title: "完整标题",
                url: "视频链接",
                date: "YYYY-MM-DD"
            }
        ]
    }
};
```

## 更新数据后的操作

1. 刷新浏览器查看效果
2. 检查城市高亮是否正确
3. 测试下钻功能
4. 验证视频链接是否可用
