/**
 * ä» data.js çš„æ ‡é¢˜ä¸­è‡ªåŠ¨æå–åŸå¸‚åç§°
 * ä½¿ç”¨æ–¹æ³•: node scripts/extract-cities.js
 * è¾“å‡º: æ›´æ–°åçš„ data/data.jsï¼ˆåŒ…å« autoCity å’Œ manualCity å­—æ®µï¼‰
 */

const fs = require('fs');
const path = require('path');

// å®Œæ•´çš„ä¸­å›½åŸå¸‚åˆ—è¡¨
const ALL_CITIES = [
    // ç›´è¾–å¸‚
    'åŒ—äº¬', 'ä¸Šæµ·', 'å¤©æ´¥', 'é‡åº†',
    // çœä¼šåŸå¸‚
    'å¹¿å·', 'æ·±åœ³', 'æˆéƒ½', 'æ­å·', 'å—äº¬', 'æ­¦æ±‰', 'é•¿æ²™', 'è¥¿å®‰', 'éƒ‘å·',
    'çŸ³å®¶åº„', 'å¤ªåŸ', 'åˆè‚¥', 'å—æ˜Œ', 'ç¦å·', 'å¦é—¨', 'å—å®', 'æµ·å£', 'æ˜†æ˜', 'è´µé˜³',
    'æ‹‰è¨', 'å…°å·', 'è¥¿å®', 'é“¶å·', 'ä¹Œé²æœ¨é½', 'å‘¼å’Œæµ©ç‰¹', 'é•¿æ˜¥', 'æ²ˆé˜³', 'å“ˆå°”æ»¨', 'æµå—',
    // æ²³åŒ—
    'å”å±±', 'ç§¦çš‡å²›', 'é‚¯éƒ¸', 'é‚¢å°', 'ä¿å®š', 'å¼ å®¶å£', 'æ‰¿å¾·', 'æ²§å·', 'å»ŠåŠ', 'è¡¡æ°´',
    'è¾›é›†', 'æ™‹å·', 'æ–°ä¹', 'éµåŒ–', 'è¿å®‰', 'æ­¦å®‰', 'å—å®«', 'æ²™æ²³', 'æ¶¿å·', 'å®šå·',
    'å®‰å›½', 'é«˜ç¢‘åº—', 'æ³Šå¤´', 'ä»»ä¸˜', 'é»„éª…', 'æ²³é—´', 'éœ¸å·', 'ä¸‰æ²³', 'æ·±å·',
    // å±±è¥¿
    'å¤§åŒ', 'é˜³æ³‰', 'é•¿æ²»', 'æ™‹åŸ', 'æœ”å·', 'æ™‹ä¸­', 'è¿åŸ', 'å¿»å·', 'ä¸´æ±¾', 'å•æ¢',
    'å¤äº¤', 'é«˜å¹³', 'ä»‹ä¼‘', 'æ°¸æµ', 'æ²³æ´¥', 'åŸå¹³', 'ä¾¯é©¬', 'éœå·', 'å­ä¹‰', 'æ±¾é˜³',
    // å†…è’™å¤
    'åŒ…å¤´', 'ä¹Œæµ·', 'èµ¤å³°', 'é€šè¾½', 'é„‚å°”å¤šæ–¯', 'å‘¼ä¼¦è´å°”', 'å·´å½¦æ·–å°”', 'ä¹Œå…°å¯Ÿå¸ƒ',
    'æ»¡æ´²é‡Œ', 'äºŒè¿æµ©ç‰¹', 'ä¹Œå…°æµ©ç‰¹', 'é˜¿å°”å±±', 'é”¡æ—æµ©ç‰¹', 'å·´å½¦æµ©ç‰¹', 'ä¸°é•‡', 'ç‰™å…‹çŸ³',
    // è¾½å®
    'å¤§è¿', 'éå±±', 'æŠšé¡º', 'æœ¬æºª', 'ä¸¹ä¸œ', 'é”¦å·', 'è¥å£', 'é˜œæ–°', 'è¾½é˜³', 'ç›˜é”¦', 'é“å²­', 'æœé˜³', 'è‘«èŠ¦å²›',
    'ç“¦æˆ¿åº—', 'æµ·åŸ', 'ä¸œæ¸¯', 'å‡¤åŸ', 'å‡Œæµ·', 'åŒ—é•‡', 'å¤§çŸ³æ¡¥', 'ç›–å·', 'ç¯å¡”', 'è°ƒå…µå±±', 'å¼€åŸ',
    // å‰æ—
    'å‰æ—', 'å››å¹³', 'è¾½æº', 'é€šåŒ–', 'ç™½å±±', 'æ¾åŸ', 'ç™½åŸ',
    'å…¬ä¸»å²­', 'æ¢…æ²³å£', 'é›†å®‰', 'ä¸´æ±Ÿ', 'å¤§å®‰', 'æ´®å—', 'ç²æ˜¥', 'é¾™äº•', 'å’Œé¾™', 'æ•¦åŒ–',
    // é»‘é¾™æ±Ÿ
    'é½é½å“ˆå°”', 'é¸¡è¥¿', 'é¹¤å²—', 'åŒé¸­å±±', 'å¤§åº†', 'ä¼Šæ˜¥', 'ä½³æœ¨æ–¯', 'ä¸ƒå°æ²³', 'ç‰¡ä¸¹æ±Ÿ', 'é»‘æ²³', 'ç»¥åŒ–',
    'ç»¥èŠ¬æ²³', 'åŒæ±Ÿ', 'è™æ—', 'å¯†å±±', 'å¯Œé”¦', 'æ¼ æ²³', 'é“åŠ›', 'å°šå¿—', 'äº”å¸¸', 'æµ·ä¼¦', 'è‚‡ä¸œ',
    // æ±Ÿè‹
    'è‹å·', 'æ— é”¡', 'å¸¸å·', 'å—é€š', 'è¿äº‘æ¸¯', 'æ·®å®‰', 'ç›åŸ', 'æ‰¬å·', 'é•‡æ±Ÿ', 'æ³°å·', 'å®¿è¿',
    'æ±Ÿé˜´', 'å®œå…´', 'æ–°æ²‚', 'é‚³å·', 'æº§é˜³', 'é‡‘å›', 'å¸¸ç†Ÿ', 'å¼ å®¶æ¸¯', 'æ˜†å±±', 'å¤ªä»“', 'å¯ä¸œ', 'å¦‚çš‹',
    // æµ™æ±Ÿ
    'å®æ³¢', 'æ¸©å·', 'å˜‰å…´', 'æ¹–å·', 'ç»å…´', 'é‡‘å', 'è¡¢å·', 'èˆŸå±±', 'å°å·', 'ä¸½æ°´',
    'å»ºå¾·', 'ä¸´å®‰', 'ä½™å§š', 'æ…ˆæºª', 'ç‘å®‰', 'ä¹æ¸…', 'æµ·å®', 'å¹³æ¹–', 'æ¡ä¹¡', 'è¯¸æš¨', 'åµŠå·',
    // å®‰å¾½
    'èŠœæ¹–', 'èšŒåŸ ', 'æ·®å—', 'é©¬éå±±', 'æ·®åŒ—', 'é“œé™µ', 'å®‰åº†', 'é»„å±±', 'æ»å·', 'é˜œé˜³', 'å®¿å·', 'å…­å®‰', 'äº³å·', 'æ± å·', 'å®£åŸ',
    'ç•Œé¦–', 'æ¡åŸ', 'å®å›½', 'å¤©é•¿', 'æ˜å…‰',
    // ç¦å»º
    'è†ç”°', 'ä¸‰æ˜', 'æ³‰å·', 'æ¼³å·', 'å—å¹³', 'é¾™å²©', 'å®å¾·',
    'ç¦æ¸…', 'é‚µæ­¦', 'æ­¦å¤·å±±', 'å»ºç“¯', 'æ°¸å®‰', 'çŸ³ç‹®', 'æ™‹æ±Ÿ', 'å—å®‰', 'é¾™æµ·', 'æ¼³å¹³',
    // æ±Ÿè¥¿
    'æ™¯å¾·é•‡', 'èä¹¡', 'ä¹æ±Ÿ', 'æ–°ä½™', 'é¹°æ½­', 'èµ£å·', 'å‰å®‰', 'å®œæ˜¥', 'æŠšå·', 'ä¸Šé¥¶',
    'ç‘æ˜Œ', 'ä¹å¹³', 'ç‘é‡‘', 'å¾·å…´', 'è´µæºª', 'æ¨Ÿæ ‘', 'ä¸°åŸ', 'é«˜å®‰',
    // å±±ä¸œ
    'é’å²›', 'æ·„åš', 'æ£åº„', 'ä¸œè¥', 'çƒŸå°', 'æ½åŠ', 'æµå®', 'æ³°å®‰', 'å¨æµ·', 'æ—¥ç…§', 'ä¸´æ²‚', 'å¾·å·', 'èŠåŸ', 'æ»¨å·', 'èæ³½',
    'èƒ¶å·', 'å³å¢¨', 'å¹³åº¦', 'è±è¥¿', 'æ»•å·', 'é¾™å£', 'è±é˜³', 'è±å·', 'æ‹›è¿œ', 'æ –éœ', 'é’å·', 'è¯¸åŸ', 'å¯¿å…‰',
    // æ²³å—
    'å¼€å°', 'æ´›é˜³', 'å¹³é¡¶å±±', 'å®‰é˜³', 'é¹¤å£', 'æ–°ä¹¡', 'ç„¦ä½œ', 'æ¿®é˜³', 'è®¸æ˜Œ', 'æ¼¯æ²³', 'ä¸‰é—¨å³¡', 'å—é˜³', 'å•†ä¸˜', 'ä¿¡é˜³', 'å‘¨å£', 'é©»é©¬åº—',
    'è¥é˜³', 'æ–°éƒ‘', 'ç™»å°', 'å·©ä¹‰', 'æ–°å¯†', 'åƒå¸ˆ', 'èˆé’¢', 'æ±å·', 'æ—å·', 'å«è¾‰', 'è¾‰å¿', 'æ²é˜³',
    // æ¹–åŒ—
    'é»„çŸ³', 'åå °', 'å®œæ˜Œ', 'è¥„é˜³', 'é„‚å·', 'è†é—¨', 'å­æ„Ÿ', 'è†å·', 'é»„å†ˆ', 'å’¸å®', 'éšå·',
    'å¤§å†¶', 'ä¸¹æ±Ÿå£', 'å®œéƒ½', 'å½“é˜³', 'ææ±Ÿ', 'è€æ²³å£', 'æ£é˜³', 'å®œåŸ', 'é’Ÿç¥¥', 'äº¬å±±', 'å®‰é™†',
    'æ½œæ±Ÿ', 'ä»™æ¡ƒ', 'å¤©é—¨',  // æ¹–åŒ—çœå¿çº§å¸‚
    // æ¹–å—
    'æ ªæ´²', 'æ¹˜æ½­', 'è¡¡é˜³', 'é‚µé˜³', 'å²³é˜³', 'å¸¸å¾·', 'å¼ å®¶ç•Œ', 'ç›Šé˜³', 'éƒ´å·', 'æ°¸å·', 'æ€€åŒ–', 'å¨„åº•',
    'æµé˜³', 'é†´é™µ', 'éŸ¶å±±', 'è€’é˜³', 'å¸¸å®', 'æ­¦å†ˆ', 'æ±¨ç½—', 'ä¸´æ¹˜', 'æ´¥å¸‚', 'æ²…æ±Ÿ', 'èµ„å…´', 'æ´ªæ±Ÿ',
    // å¹¿ä¸œ
    'ç æµ·', 'æ±•å¤´', 'ä½›å±±', 'éŸ¶å…³', 'æ¹›æ±Ÿ', 'è‚‡åº†', 'æ±Ÿé—¨', 'èŒ‚å', 'æƒ å·', 'æ¢…å·', 'æ±•å°¾', 'æ²³æº', 'é˜³æ±Ÿ', 'æ¸…è¿œ', 'ä¸œè', 'ä¸­å±±', 'æ½®å·', 'æ­é˜³', 'äº‘æµ®',
    'ä¹æ˜Œ', 'å—é›„', 'å°å±±', 'å¼€å¹³', 'é¹¤å±±', 'æ©å¹³', 'å»‰æ±Ÿ', 'é›·å·', 'å´å·', 'åŒ–å·', 'ä¿¡å®œ', 'é«˜å·', 'å››ä¼š', 'å…´å®', 'é™†ä¸°', 'é˜³æ˜¥', 'è‹±å¾·', 'è¿å·', 'æ™®å®', 'ç½—å®š',
    // å¹¿è¥¿
    'æŸ³å·', 'æ¡‚æ—', 'æ¢§å·', 'åŒ—æµ·', 'é˜²åŸæ¸¯', 'é’¦å·', 'è´µæ¸¯', 'ç‰æ—', 'ç™¾è‰²', 'è´ºå·', 'æ²³æ± ', 'æ¥å®¾', 'å´‡å·¦',
    'å²‘æºª', 'ä¸œå…´', 'æ¡‚å¹³', 'åŒ—æµ', 'é–è¥¿', 'å¹³æœ', 'å‡­ç¥¥', 'åˆå±±', 'è”æµ¦', 'æ¨ªå·',
    // æµ·å—
    'ä¸‰äºš', 'ä¸‰æ²™', 'å„‹å·', 'äº”æŒ‡å±±', 'ç¼æµ·', 'æ–‡æ˜Œ', 'ä¸‡å®', 'ä¸œæ–¹', 'é™µæ°´', 'æ–‡æ˜Œ', 'ä¸‡å®', 'ç¼æµ·',
    // å››å·
    'è‡ªè´¡', 'æ”€æèŠ±', 'æ³¸å·', 'å¾·é˜³', 'ç»µé˜³', 'å¹¿å…ƒ', 'é‚å®', 'å†…æ±Ÿ', 'ä¹å±±', 'å—å……', 'çœ‰å±±', 'å®œå®¾', 'å¹¿å®‰', 'è¾¾å·', 'é›…å®‰', 'å·´ä¸­', 'èµ„é˜³',
    'éƒ½æ±Ÿå °', 'å½­å·', 'é‚›å´ƒ', 'å´‡å·', 'å¹¿æ±‰', 'ä»€é‚¡', 'ç»µç«¹', 'æ±Ÿæ²¹', 'å³¨çœ‰å±±', 'é˜†ä¸­', 'åè“¥', 'ä¸‡æº', 'ç®€é˜³', 'è¥¿æ˜Œ',
    // è´µå·
    'å…­ç›˜æ°´', 'éµä¹‰', 'å®‰é¡º', 'æ¯•èŠ‚', 'é“œä»',
    'æ¸…é•‡', 'èµ¤æ°´', 'ä»æ€€', 'å‡¯é‡Œ', 'éƒ½åŒ€', 'å…´ä¹‰', 'ç¦æ³‰',
    // äº‘å—
    'æ›²é–', 'ç‰æºª', 'ä¿å±±', 'æ˜­é€š', 'ä¸½æ±Ÿ', 'æ™®æ´±', 'ä¸´æ²§',
    'å®‰å®', 'å®£å¨', 'è…¾å†²', 'æ¥šé›„', 'å¤§ç†', 'æ™¯æ´ª', 'èŠ’å¸‚', 'ç‘ä¸½',
    // è¥¿è—
    'æ—¥å–€åˆ™', 'æ˜Œéƒ½', 'æ—èŠ', 'å±±å—', 'é‚£æ›²',
    // é™•è¥¿
    'é“œå·', 'å®é¸¡', 'å’¸é˜³', 'æ¸­å—', 'å»¶å®‰', 'æ±‰ä¸­', 'æ¦†æ—', 'å®‰åº·', 'å•†æ´›',
    'å…´å¹³', 'éŸ©åŸ', 'åé˜´',
    // ç”˜è‚ƒ
    'é‡‘æ˜Œ', 'ç™½é“¶', 'å¤©æ°´', 'æ­¦å¨', 'å¼ æ–', 'å¹³å‡‰', 'é…’æ³‰', 'åº†é˜³', 'å®šè¥¿', 'é™‡å—',
    'ç‰é—¨', 'æ•¦ç…Œ', 'åˆä½œ', 'æ´®å—å¸‚',  // æ´®å—å¸‚ï¼ˆå¯èƒ½è¢«å†™ä¸º"æ´®å—"ï¼‰
    // é’æµ·
    'æµ·ä¸œ',
    'æ ¼å°”æœ¨', 'å¾·ä»¤å“ˆ',
    // å®å¤
    'çŸ³å˜´å±±', 'å´å¿ ', 'å›ºåŸ', 'ä¸­å«',
    'çµæ­¦', 'é’é“œå³¡',
    // æ–°ç–†
    'å…‹æ‹‰ç›ä¾', 'åé²ç•ª', 'å“ˆå¯†', 'æ˜Œå‰', 'åšå°”å¡”æ‹‰', 'å·´éŸ³éƒ­æ¥', 'é˜¿å…‹è‹', 'å…‹å­œå‹’è‹', 'å–€ä»€', 'å’Œç”°', 'ä¼ŠçŠ', 'å¡”åŸ', 'é˜¿å‹’æ³°',
    'é˜œåº·', 'åº“å°”å‹’', 'é˜¿å›¾ä»€', 'é˜¿å…‹è‹å¸‚', 'å–€ä»€å¸‚', 'å’Œç”°å¸‚', 'ä¼Šå®', 'å¥å±¯', 'å¡”åŸ', 'ä¹Œè‹', 'é˜¿å‹’æ³°'
];

// æŒ‰åŸå¸‚åé•¿åº¦é™åºæ’åºï¼Œä¼˜å…ˆåŒ¹é…æ›´é•¿çš„åŸå¸‚å
ALL_CITIES.sort((a, b) => b.length - a.length);

// ä»æ ‡é¢˜ä¸­æå–æ‰€æœ‰åŸå¸‚
function extractCitiesFromTitle(title) {
    const foundCities = new Set();
    const checked = new Set();

    for (const city of ALL_CITIES) {
        // é¿å…é‡å¤æ£€æŸ¥
        const cityKey = city;
        if (checked.has(cityKey)) continue;
        checked.add(cityKey);

        // ä½¿ç”¨æ­£åˆ™åŒ¹é…æ•´ä¸ªåŸå¸‚åï¼ˆé¿å…éƒ¨åˆ†åŒ¹é…ï¼‰
        const regex = new RegExp(city, 'g');
        let match;
        while ((match = regex.exec(title)) !== null) {
            // æ£€æŸ¥åŒ¹é…æ˜¯å¦å®Œæ•´
            const matchedText = match[0];
            if (matchedText === city) {
                foundCities.add(city);
            }
        }
    }

    return Array.from(foundCities).sort();
}

// è½¬æ¢æ•°æ®æ ¼å¼
function transformData(cityData) {
    const transformedData = {};

    Object.entries(cityData).forEach(([key, value]) => {
        // key å¯èƒ½æ˜¯åŸå¸‚åæˆ–æè¿°æ€§æ ‡é¢˜
        // videos æ•°ç»„
        const videos = value.videos || [];

        // ä¸ºæ¯ä¸ªè§†é¢‘æå–åŸå¸‚
        const transformedVideos = videos.map(video => {
            const title = video.title;
            const autoCities = extractCitiesFromTitle(title);

            // åˆ¤æ–­ key æ˜¯å¦æ˜¯æœ‰æ•ˆçš„åŸå¸‚å
            // å¦‚æœ key åœ¨åŸå¸‚åˆ—è¡¨ä¸­ï¼Œåˆ™è®¤ä¸ºæ˜¯æ‰‹åŠ¨æ ‡è®°çš„åŸå¸‚
            const isValidCityName = ALL_CITIES.includes(key);
            const manualCity = isValidCityName ? key : null;

            return {
                ...video,
                autoCities: autoCities,        // è‡ªåŠ¨æå–çš„åŸå¸‚æ•°ç»„ï¼ˆå¯èƒ½å¤šä¸ªï¼‰
                manualCity: manualCity              // äººå·¥æ‰‹åŠ¨æ ‡è®°çš„åŸå¸‚ï¼ˆå•ä¸ªæˆ–nullï¼‰
            };
        });

        transformedData[key] = {
            videos: transformedVideos
        };
    });

    return transformedData;
}

// ç”Ÿæˆè¾“å‡ºå†…å®¹
function generateOutput(transformedData) {
    const entries = Object.entries(transformedData);

    const entriesStr = entries.map(([key, value]) => {
        const videosStr = value.videos.map(video => {
            const title = video.title.replace(/\\/g, '\\\\').replace(/"/g, '\\"');
            const autoCitiesStr = JSON.stringify(video.autoCities);
            const manualCityStr = video.manualCity ? `"${video.manualCity}"` : 'null';

            return `        {
                title: "${title}",
                url: "${video.url}",
                date: "${video.date}",
                // å¯é€‰å…ƒæ•°æ®ï¼ˆå¦‚æœéœ€è¦ï¼‰
                aid: ${video.aid},
                views: ${video.views},
                danmaku: ${video.danmaku},
                // åŸå¸‚ä¿¡æ¯
                autoCities: ${autoCitiesStr},    // è‡ªåŠ¨æå–çš„åŸå¸‚
                manualCity: ${manualCityStr}     // äººå·¥æ‰‹åŠ¨æ ‡è®°çš„åŸå¸‚
            }`;
        }).join(',\n');

        return `    "${key}": {
        videos: [
${videosStr}
        ]
    }`;
    }).join(',\n\n');

    return `// åŸå¸‚æ•°æ®é…ç½®
// åŸå¸‚åç§°éœ€è¦ä¸ ECharts åœ°å›¾æ•°æ®åŒ¹é…
// æ•°æ®æ¥æºï¼šå“”å“©å“”å“©UPä¸» è€çŒ«é±¼ä¸åƒé±¼
// æœ€åæ›´æ–°æ—¶é—´: ${new Date().toISOString()}
//
// æ•°æ®è¯´æ˜ï¼š
// - autoCities: è‡ªåŠ¨ä»æ ‡é¢˜ä¸­æå–çš„åŸå¸‚æ•°ç»„ï¼ˆå¯èƒ½åŒ…å«å¤šä¸ªåŸå¸‚ï¼‰
// - manualCity: äººå·¥æ‰‹åŠ¨æ ‡è®°çš„åŸå¸‚ï¼ˆå¦‚æœä¸ºç©ºåˆ™ä»¥ autoCities ä¸ºå‡†ï¼‰

const cityData = {
${entriesStr}
};
`;
}

// ç»Ÿè®¡ä¿¡æ¯
function showStatistics(transformedData) {
    console.log('\n' + '='.repeat(60));
    console.log('ğŸ“Š åŸå¸‚æå–ç»Ÿè®¡');
    console.log('='.repeat(60));

    let totalVideos = 0;
    let totalAutoCities = 0;
    let totalManualCities = 0;
    let noManualCities = 0;

    Object.values(transformedData).forEach(entry => {
        entry.videos.forEach(video => {
            totalVideos++;
            totalAutoCities += video.autoCities.length;
            if (video.manualCity) {
                totalManualCities++;
            } else {
                noManualCities++;
            }
        });
    });

    console.log(`\næ€»è§†é¢‘æ•°: ${totalVideos}`);
    console.log(`è‡ªåŠ¨æå–çš„åŸå¸‚æ•°: ${totalAutoCities}`);
    console.log(`äººå·¥æ ‡è®°çš„åŸå¸‚æ•°: ${totalManualCities}`);
    console.log(`æœªæ ‡è®°äººå·¥åŸå¸‚çš„è§†é¢‘æ•°: ${noManualCities}`);
    console.log(`å¹³å‡æ¯ä¸ªè§†é¢‘æå–åŸå¸‚æ•°: ${(totalAutoCities / totalVideos).toFixed(2)}`);

    // ç»Ÿè®¡å“ªäº›åŸå¸‚è‡ªåŠ¨æå–æœ€å¤š
    const cityCount = {};
    Object.values(transformedData).forEach(entry => {
        entry.videos.forEach(video => {
            video.autoCities.forEach(city => {
                cityCount[city] = (cityCount[city] || 0) + 1;
            });
        });
    });

    console.log(`\nè‡ªåŠ¨æå–æœ€å¤šçš„åŸå¸‚ï¼ˆå‰10ï¼‰:`);
    console.log('-'.repeat(40));
    Object.entries(cityCount)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10)
        .forEach(([city, count], index) => {
            console.log(`${index + 1}. ${city.padEnd(8, 'ã€€')} - å‡ºç° ${count} æ¬¡`);
        });

    // æ˜¾ç¤ºæœªæ ‡è®°äººå·¥åŸå¸‚çš„ç¤ºä¾‹
    console.log(`\næœªæ ‡è®°äººå·¥åŸå¸‚çš„è§†é¢‘ç¤ºä¾‹ï¼ˆå‰5ï¼‰:`);
    console.log('-'.repeat(40));
    let count = 0;
    Object.values(transformedData).forEach(entry => {
        for (const video of entry.videos) {
            if (!video.manualCity && count < 5) {
                console.log(`${count + 1}. ${video.title}`);
                console.log(`   è‡ªåŠ¨æå–: ${video.autoCities.join(', ') || 'æ— '}`);
                count++;
            }
        }
    });
}

// ä¸»å‡½æ•°
async function main() {
    console.log('='.repeat(60));
    console.log('åŸå¸‚åç§°è‡ªåŠ¨æå–å·¥å…·');
    console.log('='.repeat(60));

    try {
        // è¯»å– data.js
        const dataPath = path.join(__dirname, '..', 'data', 'data.js');
        if (!fs.existsSync(dataPath)) {
            console.error('\nâŒ é”™è¯¯: data/data.js æ–‡ä»¶ä¸å­˜åœ¨');
            console.log('è¯·å…ˆè¿è¡Œ fetch-data.js è·å–æ•°æ®');
            process.exit(1);
        }

        const dataContent = fs.readFileSync(dataPath, 'utf8');

        // æ‰§è¡Œ data.js è·å– cityData
        const cityData = eval(dataContent + '; cityData;');

        if (!cityData || typeof cityData !== 'object') {
            console.error('\nâŒ é”™è¯¯: æ— æ³•è§£æ cityData');
            process.exit(1);
        }

        console.log(`\nâœ“ æˆåŠŸè¯»å– ${Object.keys(cityData).length} ä¸ªæ•°æ®æ¡ç›®`);

        // è½¬æ¢æ•°æ®
        const transformedData = transformData(cityData);

        // æ˜¾ç¤ºç»Ÿè®¡
        showStatistics(transformedData);

        // ç”Ÿæˆè¾“å‡º
        const output = generateOutput(transformedData);

        // å†™å…¥æ–‡ä»¶
        fs.writeFileSync(dataPath, output, 'utf8');

        console.log('\n' + '='.repeat(60));
        console.log('âœ“ æ•°æ®å·²æ›´æ–°å¹¶ä¿å­˜åˆ°: data/data.js');
        console.log('='.repeat(60));
        console.log('\nè¯´æ˜:');
        console.log('- æ¯ä¸ªè§†é¢‘ç°åœ¨åŒ…å« autoCitiesï¼ˆè‡ªåŠ¨æå–ï¼‰å’Œ manualCityï¼ˆäººå·¥æ ‡è®°ï¼‰');
        console.log('- å¦‚æœ manualCity ä¸ºç©ºï¼Œå»ºè®®ä½¿ç”¨ autoCities ä¸­çš„ç¬¬ä¸€ä¸ªåŸå¸‚ä½œä¸ºä¸»åŸå¸‚');
    } catch (error) {
        console.error('\nâŒ å‘ç”Ÿé”™è¯¯:', error);
        process.exit(1);
    }
}

// è¿è¡Œä¸»å‡½æ•°
main().catch(error => {
    console.error('\nâŒ å‘ç”Ÿé”™è¯¯:', error);
    process.exit(1);
});
